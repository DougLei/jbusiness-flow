{
	"name":"shoppingDiscount",
	"description":"购物打折流程", 
	"version":"1",
	"state":1,
	
	"params":[{
		"name":"shoppingCarId",
		"description":"购物车id",
		"scope":1,
		"required":true
	}],
	
	"events":[{
		"name":"queryProductsByShoppingCarId",
		"description":"根据购物车id获取商品集合",
		"actions":[{ 
			"type":"sql_query", 
			"content":{
				"sql":"SELECT ID, TYPE, NAME, PRICE FROM PRODUCT WHERE ID IN (SELECT PRODUCT_ID FROM SHOPPING_CAR WHERE SHOPPING_CAR_ID = ?)",
				"params":[{
					"name":"shoppingCarId",
					"scope":1
				}]
			},
			"result":{
				"name":"products",
				"scope":4,
				"dataType":"list"
			}
		}]
	},{
		"name":"productsNotExists",
		"description":"购物车中没有商品",
		"actions":[{ 
			"type":"end", 
			"content":{
				"actions":[{
					"type":"var_op_declare",
					"content":{
						"vars":[{
							"name":"productsNotExists",
							"description":"购物车中不存在商品",
							"scope":2,
							"dataType":"string",
							"value":"购物车中不存在商品"
						}]
					}
				}]
			}
		}]
	},{
		"name":"calcProductsTotalPrice",
		"description":"计算商品的总价",
		"actions":[{ 
			"type":"func_sum",
			"content":{
				"collection":"products",
				"scope":4,
				"property":"PRICE"
			},
			"result":{
				"name":"totalPrice",
				"scope":2,
				"dataType":"double"
			}
		}]
	}],
	
	"flows":[{ 
		"description":"如果指定购物车id中没有商品",
		"type":2,
		"order":1,
		"sourceEvent":"queryProductsByShoppingCarId",
		"targetEvent":"productsNotExists",	
		"conditionGroups":[{
			"conditions":[{
				"type":"comp_eq",
				"content":{
					"left":{
						"actions":[{ 
							"type":"func_count",
							"content":{
								"collection":"products",
								"scope":4
							},
							"result":{
								"name":"count",
								"dataType":"integer"
							}
						}]
					},
					"right":{
						"value":"0"
					}
				}
			}]
		}]
	},{ 
		"description":"如果指定购物车id中有商品",
		"type":2,
		"order":2,
		"sourceEvent":"queryProductsByShoppingCarId",
		"targetEvent":"calcProductsTotalPrice",
	}]
}